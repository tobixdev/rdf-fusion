---
source: bench/tests/plans/bsbm_business_intelligence.rs
expression: canonicalize_uuids(&explanation.optimized_logical_plan.to_string())
---
Projection: country AS country, ENV_PT(product) AS product, ENV_PT(nrOfReviews) AS nrOfReviews, ENV_PT(avgPrice) AS avgPrice
  Sort: ENV_SORT(nrOfReviews) DESC NULLS FIRST, ENV_SORT(country) ASC NULLS FIRST, ENV_SORT(ENV_PT(product)) ASC NULLS FIRST
    Projection: lhs.country AS country, lhs.product AS product, lhs.avgPrice AS avgPrice, rhs.nrOfReviews AS nrOfReviews
      Inner Join: lhs.country = rhs.country, lhs.product = rhs.product Filter: EBV(EQ(rhs.nrOfReviews, lhs.maxReviews))
        SubqueryAlias: lhs
          Projection: COALESCE(lhs.country, rhs.country) AS country, lhs.maxReviews AS maxReviews, rhs.product AS product, rhs.avgPrice AS avgPrice
            Inner Join:  Filter: IS_COMPATIBLE(lhs.country, rhs.country)
              SubqueryAlias: lhs
                Projection: ENV_PT(country) AS country, 00000000000000000000000000000001 AS maxReviews
                  Aggregate: groupBy=[[country AS country]], aggr=[[MAX(nrOfReviews) AS 00000000000000000000000000000001]]
                    Projection: country, enc_int64_as_rdf_term(00000000000000000000000000000002) AS nrOfReviews
                      Aggregate: groupBy=[[country AS country, product AS product]], aggr=[[count(review) AS 00000000000000000000000000000002]]
                        Projection: lhs.product AS product, rhs.review AS review, rhs.country AS country
                          Inner Join: lhs.product = rhs.product
                            SubqueryAlias: lhs
                              QuadPattern (?product <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www4.wiwiss.fu-berlin.de/bizer/bsbm/v01/instances/ProductType111>), active_graph: Union of [DefaultGraph] 
                            SubqueryAlias: rhs
                              Projection: lhs.review AS review, lhs.product AS product, rhs.country AS country
                                Inner Join: lhs.review = rhs.review
                                  SubqueryAlias: lhs
                                    QuadPattern (?review <http://www4.wiwiss.fu-berlin.de/bizer/bsbm/v01/vocabulary/reviewFor> ?product), active_graph: Union of [DefaultGraph] 
                                  SubqueryAlias: rhs
                                    Projection: lhs.review AS review, rhs.country AS country
                                      Inner Join: lhs.reviewer = rhs.reviewer
                                        SubqueryAlias: lhs
                                          QuadPattern (?review <http://purl.org/stuff/rev#reviewer> ?reviewer), active_graph: Union of [DefaultGraph] 
                                        SubqueryAlias: rhs
                                          QuadPattern (?reviewer <http://www4.wiwiss.fu-berlin.de/bizer/bsbm/v01/vocabulary/country> ?country), active_graph: Union of [DefaultGraph] 
              SubqueryAlias: rhs
                Projection: Struct({term_type:,value:,data_type:,language_tag:}) AS country, product, 00000000000000000000000000000003 AS avgPrice
                  Aggregate: groupBy=[[product AS product]], aggr=[[AVG(xsd:float(xsd:boolean(ENC_TV(price)))) AS 00000000000000000000000000000003]]
                    Projection: lhs.product AS product, rhs.price AS price
                      Inner Join: lhs.product = rhs.product
                        SubqueryAlias: lhs
                          QuadPattern (?product <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www4.wiwiss.fu-berlin.de/bizer/bsbm/v01/instances/ProductType111>), active_graph: Union of [DefaultGraph] 
                        SubqueryAlias: rhs
                          Projection: lhs.product AS product, rhs.price AS price
                            Inner Join: lhs.offer = rhs.offer
                              SubqueryAlias: lhs
                                QuadPattern (?offer <http://www4.wiwiss.fu-berlin.de/bizer/bsbm/v01/vocabulary/product> ?product), active_graph: Union of [DefaultGraph] 
                              SubqueryAlias: rhs
                                QuadPattern (?offer <http://www4.wiwiss.fu-berlin.de/bizer/bsbm/v01/vocabulary/price> ?price), active_graph: Union of [DefaultGraph] 
        SubqueryAlias: rhs
          Projection: ENV_PT(country) AS country, product, enc_int64_as_rdf_term(00000000000000000000000000000004) AS nrOfReviews
            Aggregate: groupBy=[[country AS country, product AS product]], aggr=[[count(review) AS 00000000000000000000000000000004]]
              Projection: lhs.product AS product, rhs.review AS review, rhs.country AS country
                Inner Join: lhs.product = rhs.product
                  SubqueryAlias: lhs
                    QuadPattern (?product <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www4.wiwiss.fu-berlin.de/bizer/bsbm/v01/instances/ProductType111>), active_graph: Union of [DefaultGraph] 
                  SubqueryAlias: rhs
                    Projection: lhs.review AS review, lhs.product AS product, rhs.country AS country
                      Inner Join: lhs.review = rhs.review
                        SubqueryAlias: lhs
                          QuadPattern (?review <http://www4.wiwiss.fu-berlin.de/bizer/bsbm/v01/vocabulary/reviewFor> ?product), active_graph: Union of [DefaultGraph] 
                        SubqueryAlias: rhs
                          Projection: lhs.review AS review, rhs.country AS country
                            Inner Join: lhs.reviewer = rhs.reviewer
                              SubqueryAlias: lhs
                                QuadPattern (?review <http://purl.org/stuff/rev#reviewer> ?reviewer), active_graph: Union of [DefaultGraph] 
                              SubqueryAlias: rhs
                                QuadPattern (?reviewer <http://www4.wiwiss.fu-berlin.de/bizer/bsbm/v01/vocabulary/country> ?country), active_graph: Union of [DefaultGraph]
